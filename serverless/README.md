# Serverless Functions - Taly Platform

## Overview

The `serverless/` directory contains functions designed to handle specific tasks in the Taly platform. These functions are lightweight, event-driven, and deployed in a serverless environment (e.g., AWS Lambda). They are optimized for scalability, cost efficiency, and quick execution of isolated operations.

---

## Purpose

1. **Task Automation**: Simplify repetitive tasks such as email notifications or payment processing.
2. **Scalability**: Handle sporadic workloads without over-provisioning resources.
3. **Modularity**: Isolate specific logic from core microservices to ensure clean architecture.

---

## Directory Structure

```
C:\taly\dir-taly\taly\serverless
├── send-email/               # Functions for email notifications
├── process-payment/          # Functions for payment handling
├── generate-reports/         # Functions for generating on-demand reports
├── cleanup-temp-files/       # Functions for cleaning temporary files
├── user-activity-logger/     # Functions for tracking user activities
└── shared/                   # Utilities and shared resources
```

---

## Key Functions

### **1. Send Email**

- **Path**: `send-email/`
- **Purpose**: Handles email notifications for bookings, reminders, and receipts.
- **Trigger**: Event from the booking or payment service.
- **Example Use Case**:
  - A booking confirmation email is sent when a new appointment is created.

### **2. Process Payment**

- **Path**: `process-payment/`
- **Purpose**: Processes payments through Stripe or PayPal.
- **Trigger**: HTTP requests from the payment microservice.
- **Example Use Case**:
  - Charge a customer’s card when an appointment is booked.

### **3. Generate Reports**

- **Path**: `generate-reports/`
- **Purpose**: Creates reports for bookings, payments, or user activities.
- **Trigger**: On-demand or scheduled.
- **Example Use Case**:
  - Generate a financial summary report for a company owner.

### **4. Cleanup Temporary Files**

- **Path**: `cleanup-temp-files/`
- **Purpose**: Removes unused files from temporary storage (e.g., AWS S3).
- **Trigger**: Scheduled events.
- **Example Use Case**:
  - Delete old report files generated by `generate-reports/`.

### **5. User Activity Logger**

- **Path**: `user-activity-logger/`
- **Purpose**: Tracks user interactions for analytics and auditing.
- **Trigger**: Events from frontend or backend services.
- **Example Use Case**:
  - Log when a customer views or cancels a booking.

---

## Deployment

1. **Serverless Framework**

   - Each function is configured using `serverless.yml` files.
   - Example:
     ```yaml
     service: send-email
     provider:
       name: aws
       runtime: nodejs14.x
     functions:
       sendEmail:
         handler: handler.sendEmail
         events:
           - sns: booking-confirmed
     ```

2. **Environment Variables**

   - Store sensitive information (e.g., API keys) in environment variables.
   - Example:
     - `EMAIL_API_KEY`: API key for email service.
     - `STRIPE_SECRET_KEY`: Secret key for payment processing.

3. **Testing**

   - Use local testing tools such as `serverless-offline` to simulate function triggers.
   - Run unit tests for individual functions:
     ```bash
     pnpm test
     ```

4. **CI/CD Integration**
   - Automated deployment pipelines ensure seamless updates to serverless functions.
   - Deployment command:
     ```bash
     serverless deploy
     ```

---

## Monitoring and Debugging

### **Monitoring**

- **AWS CloudWatch**: Tracks logs and performance metrics for each function.
- **Third-party Tools**: Integrate with monitoring tools like Datadog for advanced insights.

### **Debugging**

- Enable verbose logging in the function configuration.
- Use local testing tools to isolate issues before deploying changes.

---

## Contribution Guidelines

1. **Add New Functions**

   - Create a new directory for the function.
   - Include a `serverless.yml` configuration file.
   - Add a `README.md` to explain the purpose and usage.

2. **Update Existing Functions**

   - Ensure backward compatibility with existing triggers and events.
   - Add unit tests for any new functionality.

3. **Testing and Deployment**
   - Validate changes locally before pushing to the main branch.
   - Use the CI/CD pipeline for deployment.

---

## Contact

For issues or suggestions regarding serverless functions:

- **Email**: serverless-team@taly.dev
- **Slack**: #serverless-functions
